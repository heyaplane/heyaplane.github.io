<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Org To Website</title>
<meta name="generator" content="Org Mode" />
<link rel="stylesheet" type="text/css" href="rethink.css" />
</head>
<body>
<div id="preamble" class="status">
<nav id=navbar>
        <ul>
         <li><a href="index.html">Home</a></li>
         <li><a href="index.html">About</a></li>
        </ul>
       </nav>
</div>
<div id="content" class="content">
<h1 class="title">Org To Website</h1>
<div class="intro" id="org7c8bb28">
<p>
Source: <a href="https://www.youtube.com/watch?v=AfkrzFodoNw">https://www.youtube.com/watch?v=AfkrzFodoNw</a>
</p>

</div>

<div id="outline-container-org0732b14" class="outline-2">
<h2 id="org0732b14">Folder structure</h2>
<div class="outline-text-2" id="text-org0732b14">
</div>
<div id="outline-container-org9d08b23" class="outline-3">
<h3 id="org9d08b23">Site folder</h3>
<div class="outline-text-3" id="text-org9d08b23">
<p>
build_site.el
</p>
</div>
<div id="outline-container-org9b317d6" class="outline-4">
<h4 id="org9b317d6">Content</h4>
<div class="outline-text-4" id="text-org9b317d6">
<p>
index.org (landing page)
</p>
</div>
</div>
</div>
</div>

<div id="outline-container-orgf7cef73" class="outline-2">
<h2 id="orgf7cef73">Step 1: Create build script</h2>
<div class="outline-text-2" id="text-orgf7cef73">
<p>
Create file build_site.el
</p>

<div class="org-src-container">
<pre class="src src-elisp">(require 'ox-publish)

(message "Build complete!")
</pre>
</div>
</div>
</div>

<div id="outline-container-org891d427" class="outline-2">
<h2 id="org891d427">Step 2: Create shell script</h2>
<div class="outline-text-2" id="text-org891d427">
<p>
Create file build.sh
</p>

<div class="org-src-container">
<pre class="src src-sh">#!/bin/sh
emacs -Q --script build_site.el
</pre>
</div>

<p>
Run 'chmod +x build.sh' to make it executable.
</p>
</div>
</div>
<div id="outline-container-org51ed34d" class="outline-2">
<h2 id="org51ed34d">Step 3: Add publishing project config</h2>
<div class="outline-text-2" id="text-org51ed34d">
<p>
Add to build_site.el file:
</p>
<div class="org-src-container">
<pre class="src src-elisp">(setq org-publish-project-alist
      (list
       (list "my_site"
	    :recursive t
	    :base-directory "./content"
	    :publishing-directory "./public"
	    :publishing-function 'org-html-publish-to-html)))

(org-publish-all t)
</pre>
</div>

<p>
Top level lists all project configurations.
Second-level lists are for individual publishing formats (html, pdf, etc).
</p>

<p>
org-publish-all makes sure files are regenerated from scratch each time (no cached files).
</p>

<p>
Running build.sh at this point will generate a 'public' folder with the nely generated 'index.html' file representing our site.
</p>
</div>
</div>

<div id="outline-container-org24d11be" class="outline-2">
<h2 id="org24d11be">Step 4: Preview site (optional)</h2>
<div class="outline-text-2" id="text-org24d11be">
<p>
Copy 'simple-httpd.el' file from github.
</p>

<p>
Install 'simple-httpd' package with:
</p>
<div class="org-src-container">
<pre class="src src-elisp">(use-package simple-httpd
  :ensure t)
</pre>
</div>

<p>
Run: 'M-x httpd-serve-directory', choose the 'public' folder, then navigate to 'localhost:8080' in browser.
</p>
</div>
</div>
<div id="outline-container-org4f4d994" class="outline-2">
<h2 id="org4f4d994">Step 5: Improve HTML output</h2>
<div class="outline-text-2" id="text-org4f4d994">
<p>
Add following to build_site.el:
</p>
<div class="org-src-container">
<pre class="src src-elisp">:with-author nil
:with-creator t
:with-toc t
:section-numbers nil
:time-stamp-file nil

(setq org-html-validation-link nil)
</pre>
</div>

<p>
Use 'M-h v org-publish-project-alist' to see a list of :with options.
</p>
</div>
</div>

<div id="outline-container-orgdf7e59d" class="outline-2">
<h2 id="orgdf7e59d">Step 6: Improve styling</h2>
<div class="outline-text-2" id="text-orgdf7e59d">
<p>
Add following to  build_site.el:
</p>
<div class="org-src-container">
<pre class="src src-elisp">(setq org-html-head-include-scripts nil
      org-html-head-include-default-style nil
      org-html-head "&lt;link rel=\"stylesheet\" type=\"text/css\" href=\"rethink.css\" /&gt;")
</pre>
</div>

<p>
Note that the 'rethink.css' file should be sitting in the 'public' folder with the other .html files.
</p>
</div>
</div>

<div id="outline-container-org89e8a47" class="outline-2">
<h2 id="org89e8a47">Step 7: Add html preamble</h2>
<div class="outline-text-2" id="text-org89e8a47">
<p>
Add following to build_site.el:
</p>
<div class="org-src-container">
<pre class="src src-elisp">(setq org-html-preamble
      "&lt;nav id=navbar&gt;
	&lt;ul&gt;
	 &lt;li&gt;&lt;a href=\"index.html\"&gt;Home&lt;/a&gt;&lt;/li&gt;
	 &lt;li&gt;&lt;a href=\"index.html\"&gt;About&lt;/a&gt;&lt;/li&gt;
	&lt;/ul&gt;
       &lt;/nav&gt;"
      )
</pre>
</div>
</div>
</div>

<div id="outline-container-org8927495" class="outline-2">
<h2 id="org8927495">Step 8: Link to other files</h2>
<div class="outline-text-2" id="text-org8927495">
<p>
This was a difficult problem to solve, since I wanted to keep most of my org files in a separate folder. I ended up creating a separate "dummy" project that only includes the files I specify in a list:
</p>

<div class="org-src-container">
<pre class="src src-elisp">(list "sb_files"
     :base-directory "../sb"
     :base-extension "none"
     :publishing-directory "./public"
     :publishing-function 'org-html-publish-to-html
     :with-author nil
     :with-creator t
     :with-toc nil
     :section-numbers nil
     :time-stamp-file nil
     :include '(
	       "org_to_website.org"
      ))
</pre>
</div>

<p>
Unfortunately, links between files need to made manually, since links will break after converting to html and moving files into the same directory.
</p>
</div>
</div>

<div id="outline-container-org75f3e7b" class="outline-2">
<h2 id="org75f3e7b">Step 9: Better code blocks support</h2>
<div class="outline-text-2" id="text-org75f3e7b">
<p>
Insert this at the top of build_site.el:
</p>
<div class="org-src-container">
<pre class="src src-elisp">(require 'package)
(setq package-user-dir (expand-file-name "./.packages"))
(setq package-archives '(("melpa" . "https://melpa.org/packages/")
			 ("elpa" . "https://elpa.gnu.org/packages/")))

(package-initialize)
(unless package-archive-contents
  (package-refresh-contents))

(package-install 'htmlize)
(setq org-html-htmlize-output-type 'css)
</pre>
</div>
</div>

<div id="outline-container-org695024e" class="outline-3">
<h3 id="org695024e"><span class="todo TODO">TODO</span> Fix bug where line breaks can disrupt syntax highlighting</h3>
</div>
</div>

<div id="outline-container-org871989a" class="outline-2">
<h2 id="org871989a">Final build script</h2>
<div class="outline-text-2" id="text-org871989a">
<div class="org-src-container">
<pre class="src src-elisp">(require 'package)
(setq package-user-dir (expand-file-name "./.packages"))
(setq package-archives '(("melpa" . "https://melpa.org/packages/")
			 ("elpa" . "https://elpa.gnu.org/packages/")))

(package-initialize)
(unless package-archive-contents
  (package-refresh-contents))

(package-install 'htmlize)
(setq org-html-htmlize-output-type 'css)

(require 'ox-publish)

(setq org-publish-project-alist
      (list
       (list "site"
	    :recursive t
	    :base-directory "./content"
	    :publishing-directory "./public"
	    :publishing-function 'org-html-publish-to-html
	    :with-author nil
	    :with-creator t
	    :with-toc nil
	    :section-numbers nil
	    :time-stamp-file nil
	    )
       (list "sb_files"
	    :base-directory "../sb"
	    :base-extension "none"
	    :publishing-directory "./public"
	    :publishing-function 'org-html-publish-to-html
	    :with-author nil
	    :with-creator t
	    :with-toc nil
	    :section-numbers nil
	    :time-stamp-file nil
	    :include '(
		      "org_to_website.org"
	     ))
       (list "site_all"
	    :components '("site" "sb_files")
	     )))

(setq org-html-validation-link nil)
(setq org-html-head-include-scripts nil
      org-html-head-include-default-style nil
      org-html-head "&lt;link rel=\"stylesheet\" type=\"text/css\" href=\"rethink.css\" /&gt;"
      )
(setq org-html-preamble
      "&lt;nav id=navbar&gt;
	&lt;ul&gt;
	 &lt;li&gt;&lt;a href=\"index.html\"&gt;Home&lt;/a&gt;&lt;/li&gt;
	 &lt;li&gt;&lt;a href=\"index.html\"&gt;About&lt;/a&gt;&lt;/li&gt;
	&lt;/ul&gt;
       &lt;/nav&gt;"
      )

(org-publish-all t)

(message "Build complete!")
</pre>
</div>
</div>
</div>

<div id="outline-container-org2b50a57" class="outline-2">
<h2 id="org2b50a57">Tips</h2>
<div class="outline-text-2" id="text-org2b50a57">
<p>
You can prevent org publish from automatically converting underscores to subscript html elements by inserting the following into any publishable org file:
</p>
<div class="org-src-container">
<pre class="src src-org">#+OPTIONS: ^:{}
</pre>
</div>

<p>
You can create custom classes in your org files that can be referenced by css:
</p>
<div class="org-src-container">
<pre class="src src-org">#+BEGIN_intro
This is example text.
#+END_intro
</pre>
</div>

<p>
Reference this class in a css file:
</p>
<div class="org-src-container">
<pre class="src src-css">.intro {
margin: 0;
}
</pre>
</div>
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="creator"><a href="https://www.gnu.org/software/emacs/">Emacs</a> 28.1 (<a href="https://orgmode.org">Org</a> mode 9.5.2)</p>
</div>
</body>
</html>
